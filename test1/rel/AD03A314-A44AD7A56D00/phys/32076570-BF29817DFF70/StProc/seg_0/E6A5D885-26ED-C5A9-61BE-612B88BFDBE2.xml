<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="FIR_MERCHANT_BANK_RECON" directorySegmentName="seg_0" id="E6A5D885-26ED-C5A9-61BE-612B88BFDBE2">
<sourceConnName>vinettes@FCNDEV.world</sourceConnName>
<sourceObjSchema>FALCON</sourceObjSchema>
<sourceObjName>FIR_MERCHANT_BANK_RECON</sourceObjName>
<createdBy>vinettes</createdBy>
<createdTime>2014-08-20 18:32:35 UTC</createdTime>
<ownerDesignName>test</ownerDesignName>
<owner>A2F89220-3194-9EC7-59AE-89FF69B57C0E</owner>
<source>CREATE OR REPLACE procedure FALCON.FIR_MERCHANT_BANK_RECON (&lt;br/&gt;   CLEARINGHOUSE in VARCHAR2,&lt;br/&gt;   ACCOUNTID in VARCHAR2,&lt;br/&gt;   STARTDATE in DATE,&lt;br/&gt;   ENDDATE in DATE,&lt;br/&gt;   ref_cur_MERCHANT_BANK_RECON in out MERCHANT_BANK_RECONCILIATION.ref1_MERCHANT_BANK_RECON) is&lt;br/&gt;   VAR_STARTDATE FCN_SETTLEMENTS.SETTLEMENT_DATE%TYPE := STARTDATE;&lt;br/&gt;   VAR_ENDDATE  FCN_SETTLEMENTS.SETTLEMENT_DATE%TYPE := ENDDATE;&lt;br/&gt;BEGIN&lt;br/&gt; open ref_cur_MERCHANT_BANK_RECON for&lt;br/&gt;SELECT&lt;br/&gt;	ACCOUNT_ID,&lt;br/&gt;	ACCOUNT_NAME,&lt;br/&gt;	BATCH_DATE,&lt;br/&gt;	PROCIB_PROCI_PROC_CODE,&lt;br/&gt;	SUM(SETT_FPA_AMT) AS SETT_FPA_AMT,&lt;br/&gt;    	SUM(SETT_OTHER_AMT) AS SETT_OTHER_AMT,&lt;br/&gt;	SUM(CREDIT_FPA_AMT) AS CREDIT_FPA_AMT,&lt;br/&gt;	SUM(CREDIT_OTHER_AMT) AS CREDIT_OTHER_AMT,&lt;br/&gt;	SUM(CHARGEBACK_AMT) AS CHARGEBACK_AMT,&lt;br/&gt;	SUM(SETT_FPA_COUNT) AS SETT_FPA_COUNT,&lt;br/&gt;	SUM(SETT_VI_COUNT) AS SETT_VI_COUNT,&lt;br/&gt;	SUM(SETT_MC_COUNT) AS SETT_MC_COUNT,&lt;br/&gt;	SUM(CHARGEBACK_COUNT) AS CHARGEBACK_COUNT&lt;br/&gt;FROM (SELECT   /* SETTLEMENTS */&lt;br/&gt;    	FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID,&lt;br/&gt;	FCN_MERCHANT_ACCOUNTS.ACCOUNT_NAME,&lt;br/&gt;	TO_CHAR(FCN_PROCESSOR_BATCHES.CREATION_DATE,&apos;DD/MM/YYYY&apos;) AS BATCH_DATE,&lt;br/&gt;	FCN_SETTLEMENTS.PROCIB_PROCI_PROC_CODE,&lt;br/&gt;	DECODE(FCN_SETTLEMENTS.PROCIB_BRAN_CODE,&apos;FP&apos;,FCN_SETTLEMENTS.SETTLEMENT_AMT,0) AS SETT_FPA_AMT,&lt;br/&gt;    	DECODE(FCN_SETTLEMENTS.PROCIB_BRAN_CODE,&apos;FP&apos;,0,FCN_SETTLEMENTS.SETTLEMENT_AMT) AS SETT_OTHER_AMT,&lt;br/&gt;	0 AS CREDIT_FPA_AMT,&lt;br/&gt;	0 AS CREDIT_OTHER_AMT,&lt;br/&gt;	0 AS CHARGEBACK_AMT,&lt;br/&gt;	DECODE(FCN_SETTLEMENTS.PROCIB_BRAN_CODE,&apos;FP&apos;,1,0) AS SETT_FPA_COUNT,&lt;br/&gt;	DECODE(FCN_SETTLEMENTS.PROCIB_BRAN_CODE,&apos;VI&apos;,1,0) AS SETT_VI_COUNT,&lt;br/&gt;	DECODE(FCN_SETTLEMENTS.PROCIB_BRAN_CODE,&apos;MC&apos;,1,0) AS SETT_MC_COUNT,&lt;br/&gt;	0 AS CHARGEBACK_COUNT&lt;br/&gt;FROM  FCN_SETTLEMENTS,&lt;br/&gt;    FCN_PROCESSOR_BATCHES,&lt;br/&gt;    FCN_MERCHANT_ACCOUNTS&lt;br/&gt;WHERE&lt;br/&gt;    FCN_SETTLEMENTS.AUTH_MERCA_ACCOUNT_ID = FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID AND&lt;br/&gt;    FCN_SETTLEMENTS.MERCAS_PROCB_ID = FCN_PROCESSOR_BATCHES.ID AND&lt;br/&gt;    FCN_SETTLEMENTS.STAT_CODE_IN_BATCH_STATE = &apos;C&apos; AND&lt;br/&gt;    FCN_PROCESSOR_BATCHES.CREATION_DATE BETWEEN VAR_STARTDATE AND VAR_ENDDATE&lt;br/&gt;UNION ALL&lt;br/&gt;SELECT   /* CREDITS */&lt;br/&gt;    	FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID,&lt;br/&gt;	FCN_MERCHANT_ACCOUNTS.ACCOUNT_NAME,&lt;br/&gt;	TO_CHAR(FCN_PROCESSOR_BATCHES.CREATION_DATE,&apos;DD/MM/YYYY&apos;) AS BATCH_DATE,&lt;br/&gt;	FCN_CREDITS.PROCIB_PROCI_PROC_CODE,&lt;br/&gt;	0 AS SETT_FPA_AMT,&lt;br/&gt;    	0 AS SETT_OTHER_AMT,&lt;br/&gt;	DECODE(FCN_CREDITS.PROCIB_BRAN_CODE,&apos;FP&apos;,FCN_CREDITS.CREDIT_AMT,0) AS CREDIT_FPA_AMT,&lt;br/&gt;	DECODE(FCN_CREDITS.PROCIB_BRAN_CODE,&apos;FP&apos;,0,FCN_CREDITS.CREDIT_AMT) AS CREDIT_OTHER_AMT,&lt;br/&gt;	0 AS CHARGEBACK_AMT,&lt;br/&gt;	0 AS SETT_FPA_COUNT,&lt;br/&gt;	0 AS SETT_VI_COUNT,&lt;br/&gt;	0 AS SETT_MC_COUNT,&lt;br/&gt;	0 AS CHARGEBACK_COUNT&lt;br/&gt;FROM FCN_CREDITS,&lt;br/&gt;    FCN_PROCESSOR_BATCHES,&lt;br/&gt;    FCN_MERCHANT_ACCOUNTS&lt;br/&gt;WHERE&lt;br/&gt;    FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID = FCN_CREDITS.SETT_AUTH_MERCA_ACCOUNT_ID AND&lt;br/&gt;    FCN_CREDITS.MERCAS_PROCB_ID = FCN_PROCESSOR_BATCHES.ID AND&lt;br/&gt;    FCN_CREDITS.STAT_CODE_IN_BATCH_STATE = &apos;C&apos; AND&lt;br/&gt;    FCN_CREDITS.CREDR_CODE in (&apos;C&apos;, &apos;P&apos;) AND&lt;br/&gt;    FCN_PROCESSOR_BATCHES.CREATION_DATE BETWEEN VAR_STARTDATE AND VAR_ENDDATE&lt;br/&gt;UNION ALL&lt;br/&gt;SELECT   /* CHARGE BACKS */&lt;br/&gt;    	FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID,&lt;br/&gt;	FCN_MERCHANT_ACCOUNTS.ACCOUNT_NAME,&lt;br/&gt;	TO_CHAR(FCN_CREDITS.CREDIT_DATE,&apos;DD/MM/YYYY&apos;) AS BATCH_DATE,&lt;br/&gt;	FCN_CREDITS.PROCIB_PROCI_PROC_CODE,&lt;br/&gt;	0 AS SETT_FPA_AMT,&lt;br/&gt;    	0 AS SETT_OTHER_AMT,&lt;br/&gt;	0 AS CREDIT_FPA_AMT,&lt;br/&gt;	0 AS CREDIT_OTHER_AMT,&lt;br/&gt;	FCN_CREDITS.CREDIT_AMT AS CHARGEBACK_AMT,&lt;br/&gt;	0 AS SETT_FPA_COUNT,&lt;br/&gt;	0 AS SETT_VI_COUNT,&lt;br/&gt;	0 AS SETT_MC_COUNT,&lt;br/&gt;	1 AS CHARGEBACK_COUNT&lt;br/&gt;FROM FCN_CREDITS,&lt;br/&gt;    FCN_MERCHANT_ACCOUNTS&lt;br/&gt;WHERE&lt;br/&gt;    FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID = FCN_CREDITS.SETT_AUTH_MERCA_ACCOUNT_ID AND&lt;br/&gt;    FCN_CREDITS.STAT_CODE_IN_BATCH_STATE = &apos;C&apos; AND&lt;br/&gt;    FCN_CREDITS.CREDR_CODE = &apos;B&apos; AND&lt;br/&gt;    FCN_CREDITS.CREDIT_DATE  BETWEEN VAR_STARTDATE AND VAR_ENDDATE) BANK_RECONCILIATION&lt;br/&gt;GROUP BY&lt;br/&gt;	ACCOUNT_ID,&lt;br/&gt;	ACCOUNT_NAME,&lt;br/&gt;	BATCH_DATE,&lt;br/&gt;	PROCIB_PROCI_PROC_CODE;&lt;br/&gt;END FIR_MERCHANT_BANK_RECON;</source>
<body>CREATE OR REPLACE procedure FALCON.FIR_MERCHANT_BANK_RECON (&lt;br/&gt;   CLEARINGHOUSE in VARCHAR2,&lt;br/&gt;   ACCOUNTID in VARCHAR2,&lt;br/&gt;   STARTDATE in DATE,&lt;br/&gt;   ENDDATE in DATE,&lt;br/&gt;   ref_cur_MERCHANT_BANK_RECON in out MERCHANT_BANK_RECONCILIATION.ref1_MERCHANT_BANK_RECON) is&lt;br/&gt;   VAR_STARTDATE FCN_SETTLEMENTS.SETTLEMENT_DATE%TYPE := STARTDATE;&lt;br/&gt;   VAR_ENDDATE  FCN_SETTLEMENTS.SETTLEMENT_DATE%TYPE := ENDDATE;&lt;br/&gt;BEGIN&lt;br/&gt; open ref_cur_MERCHANT_BANK_RECON for&lt;br/&gt;SELECT&lt;br/&gt;	ACCOUNT_ID,&lt;br/&gt;	ACCOUNT_NAME,&lt;br/&gt;	BATCH_DATE,&lt;br/&gt;	PROCIB_PROCI_PROC_CODE,&lt;br/&gt;	SUM(SETT_FPA_AMT) AS SETT_FPA_AMT,&lt;br/&gt;    	SUM(SETT_OTHER_AMT) AS SETT_OTHER_AMT,&lt;br/&gt;	SUM(CREDIT_FPA_AMT) AS CREDIT_FPA_AMT,&lt;br/&gt;	SUM(CREDIT_OTHER_AMT) AS CREDIT_OTHER_AMT,&lt;br/&gt;	SUM(CHARGEBACK_AMT) AS CHARGEBACK_AMT,&lt;br/&gt;	SUM(SETT_FPA_COUNT) AS SETT_FPA_COUNT,&lt;br/&gt;	SUM(SETT_VI_COUNT) AS SETT_VI_COUNT,&lt;br/&gt;	SUM(SETT_MC_COUNT) AS SETT_MC_COUNT,&lt;br/&gt;	SUM(CHARGEBACK_COUNT) AS CHARGEBACK_COUNT&lt;br/&gt;FROM (SELECT   /* SETTLEMENTS */&lt;br/&gt;    	FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID,&lt;br/&gt;	FCN_MERCHANT_ACCOUNTS.ACCOUNT_NAME,&lt;br/&gt;	TO_CHAR(FCN_PROCESSOR_BATCHES.CREATION_DATE,&apos;DD/MM/YYYY&apos;) AS BATCH_DATE,&lt;br/&gt;	FCN_SETTLEMENTS.PROCIB_PROCI_PROC_CODE,&lt;br/&gt;	DECODE(FCN_SETTLEMENTS.PROCIB_BRAN_CODE,&apos;FP&apos;,FCN_SETTLEMENTS.SETTLEMENT_AMT,0) AS SETT_FPA_AMT,&lt;br/&gt;    	DECODE(FCN_SETTLEMENTS.PROCIB_BRAN_CODE,&apos;FP&apos;,0,FCN_SETTLEMENTS.SETTLEMENT_AMT) AS SETT_OTHER_AMT,&lt;br/&gt;	0 AS CREDIT_FPA_AMT,&lt;br/&gt;	0 AS CREDIT_OTHER_AMT,&lt;br/&gt;	0 AS CHARGEBACK_AMT,&lt;br/&gt;	DECODE(FCN_SETTLEMENTS.PROCIB_BRAN_CODE,&apos;FP&apos;,1,0) AS SETT_FPA_COUNT,&lt;br/&gt;	DECODE(FCN_SETTLEMENTS.PROCIB_BRAN_CODE,&apos;VI&apos;,1,0) AS SETT_VI_COUNT,&lt;br/&gt;	DECODE(FCN_SETTLEMENTS.PROCIB_BRAN_CODE,&apos;MC&apos;,1,0) AS SETT_MC_COUNT,&lt;br/&gt;	0 AS CHARGEBACK_COUNT&lt;br/&gt;FROM  FCN_SETTLEMENTS,&lt;br/&gt;    FCN_PROCESSOR_BATCHES,&lt;br/&gt;    FCN_MERCHANT_ACCOUNTS&lt;br/&gt;WHERE&lt;br/&gt;    FCN_SETTLEMENTS.AUTH_MERCA_ACCOUNT_ID = FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID AND&lt;br/&gt;    FCN_SETTLEMENTS.MERCAS_PROCB_ID = FCN_PROCESSOR_BATCHES.ID AND&lt;br/&gt;    FCN_SETTLEMENTS.STAT_CODE_IN_BATCH_STATE = &apos;C&apos; AND&lt;br/&gt;    FCN_PROCESSOR_BATCHES.CREATION_DATE BETWEEN VAR_STARTDATE AND VAR_ENDDATE&lt;br/&gt;UNION ALL&lt;br/&gt;SELECT   /* CREDITS */&lt;br/&gt;    	FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID,&lt;br/&gt;	FCN_MERCHANT_ACCOUNTS.ACCOUNT_NAME,&lt;br/&gt;	TO_CHAR(FCN_PROCESSOR_BATCHES.CREATION_DATE,&apos;DD/MM/YYYY&apos;) AS BATCH_DATE,&lt;br/&gt;	FCN_CREDITS.PROCIB_PROCI_PROC_CODE,&lt;br/&gt;	0 AS SETT_FPA_AMT,&lt;br/&gt;    	0 AS SETT_OTHER_AMT,&lt;br/&gt;	DECODE(FCN_CREDITS.PROCIB_BRAN_CODE,&apos;FP&apos;,FCN_CREDITS.CREDIT_AMT,0) AS CREDIT_FPA_AMT,&lt;br/&gt;	DECODE(FCN_CREDITS.PROCIB_BRAN_CODE,&apos;FP&apos;,0,FCN_CREDITS.CREDIT_AMT) AS CREDIT_OTHER_AMT,&lt;br/&gt;	0 AS CHARGEBACK_AMT,&lt;br/&gt;	0 AS SETT_FPA_COUNT,&lt;br/&gt;	0 AS SETT_VI_COUNT,&lt;br/&gt;	0 AS SETT_MC_COUNT,&lt;br/&gt;	0 AS CHARGEBACK_COUNT&lt;br/&gt;FROM FCN_CREDITS,&lt;br/&gt;    FCN_PROCESSOR_BATCHES,&lt;br/&gt;    FCN_MERCHANT_ACCOUNTS&lt;br/&gt;WHERE&lt;br/&gt;    FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID = FCN_CREDITS.SETT_AUTH_MERCA_ACCOUNT_ID AND&lt;br/&gt;    FCN_CREDITS.MERCAS_PROCB_ID = FCN_PROCESSOR_BATCHES.ID AND&lt;br/&gt;    FCN_CREDITS.STAT_CODE_IN_BATCH_STATE = &apos;C&apos; AND&lt;br/&gt;    FCN_CREDITS.CREDR_CODE in (&apos;C&apos;, &apos;P&apos;) AND&lt;br/&gt;    FCN_PROCESSOR_BATCHES.CREATION_DATE BETWEEN VAR_STARTDATE AND VAR_ENDDATE&lt;br/&gt;UNION ALL&lt;br/&gt;SELECT   /* CHARGE BACKS */&lt;br/&gt;    	FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID,&lt;br/&gt;	FCN_MERCHANT_ACCOUNTS.ACCOUNT_NAME,&lt;br/&gt;	TO_CHAR(FCN_CREDITS.CREDIT_DATE,&apos;DD/MM/YYYY&apos;) AS BATCH_DATE,&lt;br/&gt;	FCN_CREDITS.PROCIB_PROCI_PROC_CODE,&lt;br/&gt;	0 AS SETT_FPA_AMT,&lt;br/&gt;    	0 AS SETT_OTHER_AMT,&lt;br/&gt;	0 AS CREDIT_FPA_AMT,&lt;br/&gt;	0 AS CREDIT_OTHER_AMT,&lt;br/&gt;	FCN_CREDITS.CREDIT_AMT AS CHARGEBACK_AMT,&lt;br/&gt;	0 AS SETT_FPA_COUNT,&lt;br/&gt;	0 AS SETT_VI_COUNT,&lt;br/&gt;	0 AS SETT_MC_COUNT,&lt;br/&gt;	1 AS CHARGEBACK_COUNT&lt;br/&gt;FROM FCN_CREDITS,&lt;br/&gt;    FCN_MERCHANT_ACCOUNTS&lt;br/&gt;WHERE&lt;br/&gt;    FCN_MERCHANT_ACCOUNTS.ACCOUNT_ID = FCN_CREDITS.SETT_AUTH_MERCA_ACCOUNT_ID AND&lt;br/&gt;    FCN_CREDITS.STAT_CODE_IN_BATCH_STATE = &apos;C&apos; AND&lt;br/&gt;    FCN_CREDITS.CREDR_CODE = &apos;B&apos; AND&lt;br/&gt;    FCN_CREDITS.CREDIT_DATE  BETWEEN VAR_STARTDATE AND VAR_ENDDATE) BANK_RECONCILIATION&lt;br/&gt;GROUP BY&lt;br/&gt;	ACCOUNT_ID,&lt;br/&gt;	ACCOUNT_NAME,&lt;br/&gt;	BATCH_DATE,&lt;br/&gt;	PROCIB_PROCI_PROC_CODE;&lt;br/&gt;END FIR_MERCHANT_BANK_RECON;</body>
</StoredProcedureOraclev10g>