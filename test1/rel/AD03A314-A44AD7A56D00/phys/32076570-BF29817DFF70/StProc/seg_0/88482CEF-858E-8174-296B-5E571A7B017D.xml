<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="FIND_MERCHANTS_SPENDING" directorySegmentName="seg_0" id="88482CEF-858E-8174-296B-5E571A7B017D">
<sourceConnName>vinettes@FCNDEV.world</sourceConnName>
<sourceObjSchema>FALCON</sourceObjSchema>
<sourceObjName>FIND_MERCHANTS_SPENDING</sourceObjName>
<createdBy>vinettes</createdBy>
<createdTime>2014-08-20 18:32:35 UTC</createdTime>
<ownerDesignName>test</ownerDesignName>
<owner>A2F89220-3194-9EC7-59AE-89FF69B57C0E</owner>
<source>CREATE OR REPLACE PROCEDURE FALCON.FIND_MERCHANTS_SPENDING&lt;br/&gt;/*&lt;br/&gt; *  NAME:       find_merchants_spending&lt;br/&gt; *&lt;br/&gt; *  PURPOSE:	Accepts an payment_instrument_id (fpa account who has been disabled or enabled) and return:&lt;br/&gt; *		1.result set of all merchant account id, email where this fpa account has transactions.&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; *  IN:		p_payment_instrument_id	in authorizations.payment_instrument_id%type&lt;br/&gt; *  IN OUT	p_merchants		in out	types.ref_cursor&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; *  EXCEPTIONS:&lt;br/&gt; *&lt;br/&gt; *   Code:   Description:&lt;br/&gt; *&lt;br/&gt; *   20998,  e_exceeded_NumberOfCredits&lt;br/&gt; *   20999,  Others; Oracle error.&lt;br/&gt; *&lt;br/&gt; *  REVISIONS:&lt;br/&gt; *  Date        Author  Description&lt;br/&gt; *  ----------  ------  ------------------------------------&lt;br/&gt; *  27-Jun-2002  DMa    1. Created.&lt;br/&gt; *&lt;br/&gt; *  NOTES:&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; */&lt;br/&gt;( p_payment_instrument_id	in authorizations.payment_instrument_id%type&lt;br/&gt; ,	p_merchants		in out	types.ref_cursor&lt;br/&gt;) is&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;  v_prog    	               VARCHAR2(30) := &apos;find_merchants_spending&apos;;&lt;br/&gt;  v_outMsg	               VARCHAR2(2000);&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;begin&lt;br/&gt;&lt;br/&gt;-- find all merchants that the input pan has any auths&lt;br/&gt;IF p_payment_instrument_id is not null THEN&lt;br/&gt;&lt;br/&gt;-- select all purchase transactions relating to input pan&lt;br/&gt;&lt;br/&gt;	open p_merchants for&lt;br/&gt;	SELECT distinct a.merca_account_id, nvl(ma.email,&apos;NONE&apos;)&lt;br/&gt;        FROM authorizations a, merchant_accounts ma&lt;br/&gt;	WHERE	a.payment_instrument_id	= p_payment_instrument_id&lt;br/&gt;	  and   a.procib_proci_proc_code = &apos;FPY&apos;&lt;br/&gt;	  and   a.procib_bran_code 	= &apos;FP&apos;&lt;br/&gt;	  and	a.merca_account_id 	= ma.account_id&lt;br/&gt;	;&lt;br/&gt;&lt;br/&gt;END IF;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;EXCEPTION&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;  when others then&lt;br/&gt;&lt;br/&gt;      	v_outMsg  := &apos;--- &apos; || v_prog || &apos; FAIL: error msg: &apos; || SQLERRM || &apos; payment_instrument_id: &apos; ||&lt;br/&gt;                      p_payment_instrument_id || &apos; - end &apos; || v_prog || &apos; ---&apos;;&lt;br/&gt;&lt;br/&gt;     	dbms_output.put_line (v_outMsg);&lt;br/&gt;&lt;br/&gt;      	raise_application_error(-20996, v_outMsg);&lt;br/&gt;&lt;br/&gt;end find_merchants_spending;</source>
<body>CREATE OR REPLACE PROCEDURE FALCON.FIND_MERCHANTS_SPENDING&lt;br/&gt;/*&lt;br/&gt; *  NAME:       find_merchants_spending&lt;br/&gt; *&lt;br/&gt; *  PURPOSE:	Accepts an payment_instrument_id (fpa account who has been disabled or enabled) and return:&lt;br/&gt; *		1.result set of all merchant account id, email where this fpa account has transactions.&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; *  IN:		p_payment_instrument_id	in authorizations.payment_instrument_id%type&lt;br/&gt; *  IN OUT	p_merchants		in out	types.ref_cursor&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; *  EXCEPTIONS:&lt;br/&gt; *&lt;br/&gt; *   Code:   Description:&lt;br/&gt; *&lt;br/&gt; *   20998,  e_exceeded_NumberOfCredits&lt;br/&gt; *   20999,  Others; Oracle error.&lt;br/&gt; *&lt;br/&gt; *  REVISIONS:&lt;br/&gt; *  Date        Author  Description&lt;br/&gt; *  ----------  ------  ------------------------------------&lt;br/&gt; *  27-Jun-2002  DMa    1. Created.&lt;br/&gt; *&lt;br/&gt; *  NOTES:&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; */&lt;br/&gt;( p_payment_instrument_id	in authorizations.payment_instrument_id%type&lt;br/&gt; ,	p_merchants		in out	types.ref_cursor&lt;br/&gt;) is&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;  v_prog    	               VARCHAR2(30) := &apos;find_merchants_spending&apos;;&lt;br/&gt;  v_outMsg	               VARCHAR2(2000);&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;begin&lt;br/&gt;&lt;br/&gt;-- find all merchants that the input pan has any auths&lt;br/&gt;IF p_payment_instrument_id is not null THEN&lt;br/&gt;&lt;br/&gt;-- select all purchase transactions relating to input pan&lt;br/&gt;&lt;br/&gt;	open p_merchants for&lt;br/&gt;	SELECT distinct a.merca_account_id, nvl(ma.email,&apos;NONE&apos;)&lt;br/&gt;        FROM authorizations a, merchant_accounts ma&lt;br/&gt;	WHERE	a.payment_instrument_id	= p_payment_instrument_id&lt;br/&gt;	  and   a.procib_proci_proc_code = &apos;FPY&apos;&lt;br/&gt;	  and   a.procib_bran_code 	= &apos;FP&apos;&lt;br/&gt;	  and	a.merca_account_id 	= ma.account_id&lt;br/&gt;	;&lt;br/&gt;&lt;br/&gt;END IF;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;EXCEPTION&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;  when others then&lt;br/&gt;&lt;br/&gt;      	v_outMsg  := &apos;--- &apos; || v_prog || &apos; FAIL: error msg: &apos; || SQLERRM || &apos; payment_instrument_id: &apos; ||&lt;br/&gt;                      p_payment_instrument_id || &apos; - end &apos; || v_prog || &apos; ---&apos;;&lt;br/&gt;&lt;br/&gt;     	dbms_output.put_line (v_outMsg);&lt;br/&gt;&lt;br/&gt;      	raise_application_error(-20996, v_outMsg);&lt;br/&gt;&lt;br/&gt;end find_merchants_spending;</body>
</StoredProcedureOraclev10g>