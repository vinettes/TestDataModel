<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="BUR_MERCA_BRAND_RISK_INFO" directorySegmentName="seg_0" id="47EF3029-F452-E6BE-45BC-D88C5E2CFF18">
<sourceConnName>vinettes@FCNDEV.world</sourceConnName>
<sourceObjSchema>FALCON</sourceObjSchema>
<sourceObjName>BUR_MERCA_BRAND_RISK_INFO</sourceObjName>
<createdBy>vinettes</createdBy>
<createdTime>2014-08-20 18:32:33 UTC</createdTime>
<ownerDesignName>test</ownerDesignName>
<actions>UPDATE</actions>
<body>declare&lt;br/&gt;/*&lt;br/&gt; *&lt;br/&gt; *   PURPOSE: To keep an history of statuses for the batch.&lt;br/&gt; *&lt;br/&gt; *   EXCEPTIONS:  Name:&lt;br/&gt; *                Code:&lt;br/&gt; *                Desc:&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; *   REVISIONS:&lt;br/&gt; *   Date       Author        Description&lt;br/&gt; *   ---------  ------        ----------------------------------------&lt;br/&gt; *   21 Oct 02  Erik Mailhiot 1. Created&lt;br/&gt; *   13 Nov 02  Erik Mailhiot 1. Setting description field in journal table&lt;br/&gt; *                               CVS info: $Id: bur_merca_brand_risk_info.sql,v 1.1 2005/06/23 19:04:09 ioana Exp $&lt;br/&gt; *&lt;br/&gt; *   NOTES:&lt;br/&gt; */&lt;br/&gt;    v_dummy_field merca_brand_risk_info_jn.bran_code%type;&lt;br/&gt;&lt;br/&gt;    cursor c_get_old_row (cp_merca_account_id merca_brand_risk_info_jn.merca_account_id%type,&lt;br/&gt;                             cp_bran_code merca_brand_risk_info_jn.bran_code%type) is&lt;br/&gt;        select bran_code&lt;br/&gt;          from merca_brand_risk_info_jn&lt;br/&gt;         where merca_account_id = cp_merca_account_id&lt;br/&gt;           and bran_code = cp_bran_code&lt;br/&gt;           and thru_date is null&lt;br/&gt;           for update;&lt;br/&gt;&lt;br/&gt;    v_sysdate date := sysdate;&lt;br/&gt;begin&lt;br/&gt;&lt;br/&gt;/* audit section */&lt;br/&gt;:new.modification_date := sysdate;&lt;br/&gt;&lt;br/&gt;if not updating (&apos;modified_by&apos;) then&lt;br/&gt;	if (user != &apos;FALTXN&apos;) then&lt;br/&gt;:new.modified_by := user ;&lt;br/&gt;	end if ;&lt;br/&gt;end if ;&lt;br/&gt;&lt;br/&gt;  open c_get_old_row(:new.merca_account_id, :new.bran_code);&lt;br/&gt;  fetch c_get_old_row into v_dummy_field;&lt;br/&gt;&lt;br/&gt;  if c_get_old_row%found then -- Old record exists for this entity.&lt;br/&gt;    if cbrr_remap_package.is_updated_by_remap_trigger then&lt;br/&gt;      insert into merca_brand_risk_info_jn (&lt;br/&gt;        merca_account_id,&lt;br/&gt;        bran_code,&lt;br/&gt;        cb_rate,&lt;br/&gt;        cbrrit_cde,&lt;br/&gt;        mercbrij_from_date,&lt;br/&gt;        modified_by,&lt;br/&gt;        ip_address,&lt;br/&gt;        thru_date,&lt;br/&gt;        description&lt;br/&gt;      ) values (&lt;br/&gt;        :new.merca_account_id,&lt;br/&gt;        :new.bran_code,&lt;br/&gt;        :new.cb_rate,&lt;br/&gt;        :new.cbrrit_cde,&lt;br/&gt;        v_sysdate,&lt;br/&gt;        :new.modified_by,&lt;br/&gt;        :new.ip_address,&lt;br/&gt;        null,&lt;br/&gt;        cbrr_remap_package.v_description&lt;br/&gt;      );&lt;br/&gt;    else&lt;br/&gt;      insert into merca_brand_risk_info_jn (&lt;br/&gt;        merca_account_id,&lt;br/&gt;        bran_code,&lt;br/&gt;        cb_rate,&lt;br/&gt;        cbrrit_cde,&lt;br/&gt;        mercbrij_from_date,&lt;br/&gt;        modified_by,&lt;br/&gt;        ip_address,&lt;br/&gt;        thru_date,&lt;br/&gt;        description&lt;br/&gt;      ) (&lt;br/&gt;&lt;br/&gt;        select :new.merca_account_id,&lt;br/&gt;        :new.bran_code,&lt;br/&gt;        :new.cb_rate,&lt;br/&gt;        :new.cbrrit_cde,&lt;br/&gt;        v_sysdate,&lt;br/&gt;        :new.modified_by,&lt;br/&gt;        :new.ip_address,&lt;br/&gt;        null, description&lt;br/&gt;           from cb_rating_ranges&lt;br/&gt;          where cbrrit_cde = :new.cbrrit_cde&lt;br/&gt;            and bran_code = :new.bran_code&lt;br/&gt;      );&lt;br/&gt;    end if;&lt;br/&gt;&lt;br/&gt;      /* Set the thru_date of the old record...&lt;br/&gt;       * only once the insert worked.&lt;br/&gt;       */&lt;br/&gt;      update merca_brand_risk_info_jn&lt;br/&gt;         set thru_date = v_sysdate - (1/24/60/60) /* one second */&lt;br/&gt;       where current of c_get_old_row;&lt;br/&gt;  else&lt;br/&gt;    if cbrr_remap_package.is_updated_by_remap_trigger then&lt;br/&gt;      insert into merca_brand_risk_info_jn (&lt;br/&gt;        merca_account_id,&lt;br/&gt;        bran_code,&lt;br/&gt;        cb_rate,&lt;br/&gt;        cbrrit_cde,&lt;br/&gt;        mercbrij_from_date,&lt;br/&gt;        modified_by,&lt;br/&gt;        ip_address,&lt;br/&gt;        thru_date,&lt;br/&gt;        description&lt;br/&gt;      ) values (&lt;br/&gt;        :new.merca_account_id,&lt;br/&gt;        :new.bran_code,&lt;br/&gt;        :new.cb_rate,&lt;br/&gt;        :new.cbrrit_cde,&lt;br/&gt;        v_sysdate,&lt;br/&gt;        :new.modified_by,&lt;br/&gt;        :new.ip_address,&lt;br/&gt;        null,&lt;br/&gt;        cbrr_remap_package.v_description&lt;br/&gt;      );&lt;br/&gt;    else&lt;br/&gt;      insert into merca_brand_risk_info_jn (&lt;br/&gt;        merca_account_id,&lt;br/&gt;        bran_code,&lt;br/&gt;        cb_rate,&lt;br/&gt;        cbrrit_cde,&lt;br/&gt;        mercbrij_from_date,&lt;br/&gt;        modified_by,&lt;br/&gt;        ip_address,&lt;br/&gt;        thru_date,&lt;br/&gt;        description&lt;br/&gt;      ) (select :new.merca_account_id,&lt;br/&gt;        :new.bran_code,&lt;br/&gt;        :new.cb_rate,&lt;br/&gt;        :new.cbrrit_cde,&lt;br/&gt;        v_sysdate,&lt;br/&gt;        :new.modified_by,&lt;br/&gt;        :new.ip_address,&lt;br/&gt;        null,description&lt;br/&gt;           from cb_rating_ranges&lt;br/&gt;          where cbrrit_cde = :new.cbrrit_cde&lt;br/&gt;            and bran_code = :new.bran_code&lt;br/&gt;      );&lt;br/&gt;    end if;&lt;br/&gt;  end if;&lt;br/&gt;  close c_get_old_row;&lt;br/&gt;&lt;br/&gt;END ;&lt;br/&gt;</body>
<triggerTime>BEFORE</triggerTime>
<owner>A2F89220-3194-9EC7-59AE-89FF69B57C0E</owner>
<table>7A8F0E6D-D3BF-ABBA-08DB-3834A1F0198F</table>
</TriggerOraclev10g>