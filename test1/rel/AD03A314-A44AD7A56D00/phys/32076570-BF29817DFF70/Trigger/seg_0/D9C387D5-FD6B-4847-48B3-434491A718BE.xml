<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="BUR_MERCA_ACCT_RISK_INFO" directorySegmentName="seg_0" id="D9C387D5-FD6B-4847-48B3-434491A718BE">
<sourceConnName>vinettes@FCNDEV.world</sourceConnName>
<sourceObjSchema>FALCON</sourceObjSchema>
<sourceObjName>BUR_MERCA_ACCT_RISK_INFO</sourceObjName>
<createdBy>vinettes</createdBy>
<createdTime>2014-08-20 18:32:33 UTC</createdTime>
<ownerDesignName>test</ownerDesignName>
<actions>UPDATE</actions>
<body>declare&lt;br/&gt;/*&lt;br/&gt; *   NAME:    BUR_MERCA_ACCT_RISK_INFO&lt;br/&gt; *&lt;br/&gt; *   PURPOSE: To keep a rating history for each merchant.&lt;br/&gt; *&lt;br/&gt; *   EXCEPTIONS:  Name:&lt;br/&gt; *                Code:&lt;br/&gt; *                Desc:&lt;br/&gt; *&lt;br/&gt; *&lt;br/&gt; *   REVISIONS:&lt;br/&gt; *   Date       Author        Description&lt;br/&gt; *   ---------  ------        ----------------------------------------&lt;br/&gt; *   20 Jun 02  Erik Mailhiot 1. Created&lt;br/&gt; *&lt;br/&gt; *   NOTES:&lt;br/&gt; */&lt;br/&gt;&lt;br/&gt;    v_dummy_field merca_acct_risk_info_jn.cb_rate%type;&lt;br/&gt;&lt;br/&gt;    cursor c_get_old_row (cp_merca_account_id merca_acct_risk_info_jn.merca_account_id%type) is&lt;br/&gt;        select cb_rate&lt;br/&gt;          from merca_acct_risk_info_jn&lt;br/&gt;         where merca_account_id = cp_merca_account_id&lt;br/&gt;           and thru_date is null&lt;br/&gt;           for update;&lt;br/&gt;&lt;br/&gt;    v_sysdate date := sysdate;&lt;br/&gt;&lt;br/&gt;begin&lt;br/&gt;&lt;br/&gt;/* audit section */&lt;br/&gt;:new.modification_date := sysdate;&lt;br/&gt;&lt;br/&gt;if not updating (&apos;modified_by&apos;) then&lt;br/&gt;	if (user != &apos;FALTXN&apos;) then&lt;br/&gt;:new.modified_by := user ;&lt;br/&gt;	end if ;&lt;br/&gt;end if ;&lt;br/&gt;&lt;br/&gt;  open c_get_old_row(:new.merca_account_id);&lt;br/&gt;  fetch c_get_old_row into v_dummy_field;&lt;br/&gt;&lt;br/&gt;  if c_get_old_row%found then -- Old status exists for this batch.&lt;br/&gt;      insert into merca_acct_risk_info_jn (&lt;br/&gt;        merca_account_id,&lt;br/&gt;        cb_rate,&lt;br/&gt;        cbrrit_cde,&lt;br/&gt;        mercarij_from_date,&lt;br/&gt;        modified_by,&lt;br/&gt;        ip_address,&lt;br/&gt;        thru_date&lt;br/&gt;      ) values (&lt;br/&gt;        :new.merca_account_id,&lt;br/&gt;        :new.cb_rate,&lt;br/&gt;        :new.cbrrit_cde,&lt;br/&gt;        v_sysdate,&lt;br/&gt;        :new.modified_by,&lt;br/&gt;        :new.ip_address,&lt;br/&gt;        null&lt;br/&gt;      );&lt;br/&gt;&lt;br/&gt;      /* Set the thru_date of the old record...&lt;br/&gt;       * only once the insert worked.&lt;br/&gt;       */&lt;br/&gt;      update merca_acct_risk_info_jn&lt;br/&gt;         set thru_date = v_sysdate - (1/24/60/60) /* one second */&lt;br/&gt;       where current of c_get_old_row;&lt;br/&gt;  else&lt;br/&gt;      insert into merca_acct_risk_info_jn (&lt;br/&gt;        merca_account_id,&lt;br/&gt;        cb_rate,&lt;br/&gt;        cbrrit_cde,&lt;br/&gt;        mercarij_from_date,&lt;br/&gt;        modified_by,&lt;br/&gt;        ip_address,&lt;br/&gt;        thru_date&lt;br/&gt;      ) values (&lt;br/&gt;        :new.merca_account_id,&lt;br/&gt;        :new.cb_rate,&lt;br/&gt;        :new.cbrrit_cde,&lt;br/&gt;        v_sysdate,&lt;br/&gt;        :new.modified_by,&lt;br/&gt;        :new.ip_address,&lt;br/&gt;        null&lt;br/&gt;      );&lt;br/&gt;  end if;&lt;br/&gt;  close c_get_old_row;&lt;br/&gt;&lt;br/&gt;end;&lt;br/&gt;</body>
<triggerTime>BEFORE</triggerTime>
<owner>A2F89220-3194-9EC7-59AE-89FF69B57C0E</owner>
<table>347DD234-E7CA-B53A-C0FD-D7CEB445CA0B</table>
</TriggerOraclev10g>