<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="BUR_MERCHANT_ACCT_PERMISSIONS" directorySegmentName="seg_0" id="208E9F65-9573-22E9-3DD1-5C4DD1CFA253">
<sourceConnName>vinettes@FCNDEV.world</sourceConnName>
<sourceObjSchema>FALCON</sourceObjSchema>
<sourceObjName>BUR_MERCHANT_ACCT_PERMISSIONS</sourceObjName>
<createdBy>vinettes</createdBy>
<createdTime>2014-08-20 18:32:33 UTC</createdTime>
<ownerDesignName>test</ownerDesignName>
<actions>UPDATE</actions>
<body>DECLARE&lt;br/&gt;/*&lt;br/&gt; *   NAME:    BUR_merchant_acct_permissions&lt;br/&gt; *&lt;br/&gt; *   PURPOSE: AUDITING/JOURNALING TRIGGER.&lt;br/&gt; *   EXCEPTIONS:  None&lt;br/&gt; *   REVISIONS:&lt;br/&gt; *   Date        Author         Description&lt;br/&gt; *   ----------- -------------- ----------------------------------------&lt;br/&gt; *   14-Mar-08   Erik Mailhiot  1. Created.&lt;br/&gt; *   30-Jul-10   Erik Mailhiot  1. Embed journaling code into the trigger (ref story 4783 and bug E2027)&lt;br/&gt; *&lt;br/&gt; *   CVS Info $Id$&lt;br/&gt; *&lt;br/&gt; *   NOTES: Journaling private proc has been kept intact so that it could be moved back&lt;br/&gt; *          easily to the fcn_journal_pkg if ever the databases get merged.&lt;br/&gt; */&lt;br/&gt;    v_err_code            NUMBER;&lt;br/&gt;    v_err_msg             VARCHAR2 (4000);&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;/* 8 declaration items taken from fcn_journal_pkg */&lt;br/&gt;IS_DELETING  CONSTANT VARCHAR2(3) := &apos;DEL&apos;;&lt;br/&gt;IS_INSERTING CONSTANT VARCHAR2(3) := &apos;INS&apos;;&lt;br/&gt;IS_UPDATING  CONSTANT VARCHAR2(3) := &apos;UPD&apos;;&lt;br/&gt;&lt;br/&gt;FIRST_STATEMENT     CONSTANT VARCHAR2(2) := &apos;S1&apos;;&lt;br/&gt;SECOND_STATEMENT    CONSTANT VARCHAR2(2) := &apos;S2&apos;;&lt;br/&gt;NO_ERROR_STATUS     CONSTANT PLS_INTEGER := 0;&lt;br/&gt;ERROR_FIRST_STATUS  CONSTANT PLS_INTEGER := 1;&lt;br/&gt;ERROR_SECOND_STATUS CONSTANT PLS_INTEGER := 2;&lt;br/&gt;&lt;br/&gt;/* Common Proc taken as is from fcn_journal_pkg */&lt;br/&gt;procedure merchant_acct_permns_jn_prc (&lt;br/&gt; p_process IN VARCHAR2&lt;br/&gt;,p_merca_account_id IN merchant_acct_permns_jn.merca_account_id%TYPE&lt;br/&gt;,p_gate_code IN merchant_acct_permns_jn.gate_code%TYPE&lt;br/&gt;,p_txn_permission IN merchant_acct_permns_jn.txn_permission%TYPE&lt;br/&gt;,p_modified_by IN merchant_acct_permns_jn.modified_by%TYPE&lt;br/&gt;,p_from_date   IN merchant_acct_permns_jn.from_date%TYPE&lt;br/&gt;,p_err_code OUT NOCOPY NUMBER&lt;br/&gt;,p_err_msg  OUT NOCOPY VARCHAR2&lt;br/&gt;)&lt;br/&gt; IS&lt;br/&gt; v_stmt   VARCHAR2 (2);&lt;br/&gt; PROC_NAME  CONSTANT VARCHAR2(30) := &apos;MERCHANT_ACCT_PERMNS_JN_PRC&apos;;&lt;br/&gt; TAB_NAME   CONSTANT VARCHAR2(30) := &apos;MERCHANT_ACCT_PERMNS_JN&apos;;&lt;br/&gt; BEGIN&lt;br/&gt;  p_err_code := NO_ERROR_STATUS;&lt;br/&gt;  p_err_msg := NULL;&lt;br/&gt;&lt;br/&gt;  IF (p_process IN (IS_UPDATING, IS_DELETING)) THEN&lt;br/&gt;   v_stmt := FIRST_STATEMENT;&lt;br/&gt;&lt;br/&gt;   UPDATE merchant_acct_permns_jn&lt;br/&gt;      SET thru_date = SYSDATE - (INTERVAL &apos;1&apos; SECOND)&lt;br/&gt;    WHERE thru_date IS NULL&lt;br/&gt;      AND merca_account_id = p_merca_account_id&lt;br/&gt;      AND gate_code = p_gate_code;&lt;br/&gt;&lt;br/&gt; IF SQL%ROWCOUNT &gt; 1 THEN&lt;br/&gt;  p_err_code := ERROR_FIRST_STATUS;&lt;br/&gt;  p_err_msg  := PROC_NAME||&apos;, error in stmt &apos; || v_stmt&lt;br/&gt;                 || &apos; tries to update more than 1 row from the &apos;||TAB_NAME||&apos; table for id &apos; || p_merca_account_id||&apos; - &apos;||p_gate_code;&lt;br/&gt;  RETURN;&lt;br/&gt; END IF;&lt;br/&gt;  END IF;&lt;br/&gt;&lt;br/&gt; IF (p_process IN (IS_INSERTING, IS_UPDATING)) THEN&lt;br/&gt;  v_stmt := SECOND_STATEMENT;&lt;br/&gt;&lt;br/&gt;  INSERT INTO merchant_acct_permns_jn(merca_account_id, gate_code, txn_permission, modified_by, from_date, thru_date)&lt;br/&gt;       VALUES (p_merca_account_id, p_gate_code, p_txn_permission, p_modified_by, p_from_date, NULL);&lt;br/&gt;&lt;br/&gt; END IF;&lt;br/&gt;&lt;br/&gt; EXCEPTION&lt;br/&gt;  WHEN OTHERS THEN&lt;br/&gt;  p_err_code := ERROR_SECOND_STATUS;&lt;br/&gt;  p_err_msg  := PROC_NAME||&apos;, id &apos; || p_merca_account_id||&apos; - &apos;||p_gate_code || &apos;, stmt &apos; || v_stmt || &apos;, &apos; ||SQLERRM;&lt;br/&gt;END merchant_acct_permns_jn_prc;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;    /* audit section */&lt;br/&gt;    :NEW.modification_date := SYSDATE;&lt;br/&gt;    &lt;br/&gt;    IF NOT UPDATING (&apos;modified_by&apos;) THEN&lt;br/&gt;        IF (USER != &apos;FCNTXN&apos;) THEN&lt;br/&gt;            :NEW.modified_by := USER;&lt;br/&gt;            &lt;br/&gt;        END IF;&lt;br/&gt;    END IF;&lt;br/&gt;&lt;br/&gt;    /* journal section */&lt;br/&gt;    /* just add prefix &quot;fcn_journal_pkg.&quot; if ever the journaling proc moves back into the journaling package */&lt;br/&gt;    merchant_acct_permns_jn_prc (&lt;br/&gt;          p_process            =&gt; fcn_journal_pkg.IS_UPDATING&lt;br/&gt;         ,p_merca_account_id   =&gt; :new.merca_account_id&lt;br/&gt;         ,p_gate_code          =&gt; :new.gate_code&lt;br/&gt;         ,p_txn_permission     =&gt; :new.txn_permission&lt;br/&gt;         ,p_modified_by        =&gt; :new.modified_by&lt;br/&gt;         ,p_from_date          =&gt; :new.modification_date&lt;br/&gt;         ,p_err_code           =&gt; v_err_code&lt;br/&gt;         ,p_err_msg            =&gt; v_err_msg);&lt;br/&gt;&lt;br/&gt;    IF v_err_code &lt;&gt; 0 THEN&lt;br/&gt;        raise_application_error (-20001, &apos;BUR_merchant_acct_permissions trig, &apos; || v_err_msg);&lt;br/&gt;    END IF;&lt;br/&gt;&lt;br/&gt;END;</body>
<triggerTime>BEFORE</triggerTime>
<owner>A2F89220-3194-9EC7-59AE-89FF69B57C0E</owner>
<table>5AA6C091-6BE0-3A3D-C25A-450D2282C0A4</table>
</TriggerOraclev10g>